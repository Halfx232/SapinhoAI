<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jogo do Sapinho</title>
  <link rel="icon" href="https://em-content.zobj.net/thumbs/160/twitter/322/frog_1f438.png" type="image/png">
  <meta property="og:title" content="Jogo do Sapinho">
  <meta property="og:description" content="Uma aventura divertida com um sapo!">
  <meta property="og:image" content="https://sapinho-ai.vercel.app/thumbnail.jpg">
  <meta property="og:url" content="https://sapinho-ai.vercel.app">
  <meta name="twitter:card" content="summary_large_image">
  <style>
    html:not(.loaded) body { margin:0; padding:0; background:#1a1a1a; color:#fff; visibility:hidden; font-family:sans-serif; }
    #top-bar, #game-container, #test-version, #about-section, #footer { display:none; }
    #start-banner, #game-over-banner, #victory-banner { display:none; position:absolute; text-align:center; z-index:1000; }
    #start-banner.active, #game-over-banner.active, #victory-banner.active { display:block; }
    canvas:not(.ready) { display:none; }
    #top-bar { background:#1b5e20; display:flex; justify-content:space-between; padding:10px; }
    .weather-clock { font-size:14px; }
    #nav-menu { display:none; }
    #nav-menu.open { display:block; position:absolute; top:50px; right:10px; background:#1b5e20; padding:10px; }
    #nav-menu ul { list-style:none; margin:0; padding:0; }
    #nav-menu a { color:white; text-decoration:none; display:block; padding:5px; }
  </style>
  <link rel="stylesheet" href="styles-mobile.css?v=17" media="screen and (max-width:1023px)">
  <link rel="stylesheet" href="styles-desktop.css?v=6" media="screen and (min-width:1024px)">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-SEU-ID" crossorigin="anonymous"></script>
</head>
<body>

  <div id="top-bar">
    <button id="menu-toggle" class="fa fa-bars"></button>
    <div class="weather-clock">
      <div id="weather">Carregando...</div>
      <div id="clock">Carregando...</div>
    </div>
    <nav id="nav-menu">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="sobre.html">Sobre</a></li>
        <li><a href="contato.html">Contato</a></li>
        <li><a href="politicas.html">Políticas</a></li>
      </ul>
    </nav>
  </div>

  <div id="game-container">
    <div id="top-ad">
      <ins class="adsbygoogle" style="display:block;width:100%;max-width:400px;height:100px;background:#ccc;" data-ad-client="ca-pub-SEU-ID" data-ad-slot="SEU-SLOT-ID-MOBILE-TOP" data-ad-format="horizontal"></ins>
    </div>
    <div id="left-ad">
      <ins class="adsbygoogle" style="display:block;width:300px;height:400px;" data-ad-client="ca-pub-SEU-ID" data-ad-slot="SEU-SLOT-ID-DESKTOP" data-ad-format="rectangle"></ins>
    </div>
    <canvas id="gameCanvas"></canvas>
    <div id="right-ad">
      <ins class="adsbygoogle" style="display:block;width:300px;height:400px;" data-ad-client="ca-pub-SEU-ID" data-ad-slot="SEU-SLOT-ID-DESKTOP" data-ad-format="rectangle"></ins>
    </div>

    <div id="start-banner" class="active">
      <h1>Bem-vindo ao Jogo do Sapinho!</h1>
      <p>Toque ou pressione qualquer tecla para jogar</p>
    </div>
    <div id="game-over-banner">
      <h2>Game Over!</h2>
      <p>Pontuação: <span id="final-score">0</span></p>
      <button id="restart-button">Jogar Novamente</button>
    </div>
    <div id="victory-banner">
      <h2>Parabéns! Você venceu!</h2>
      <p>Pontuação: <span id="victory-score">0</span></p>
      <button id="play-again-button">Jogar Novamente</button>
    </div>
  </div>

  <div id="test-version"><p>Versão de teste do SapinhoAI</p></div>
  <div id="about-section"><h2>Sobre</h2><p>Jogo desenvolvido com IA. Atualizações em breve!</p></div>
  <div id="footer">Siga: <a href="#">Instagram</a> | <a href="#">YouTube</a> | <a href="#">TikTok</a></div>

  <!-- Sons (sem música de fundo) -->
  <audio id="jumpSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>
  <audio id="failSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
  <audio id="victorySound" src="Victory.mp3"></audio>

  <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
  <script>
    // === INICIALIZAÇÃO ===
    document.addEventListener('DOMContentLoaded', () => {
      document.documentElement.classList.add('loaded');
      document.getElementById('gameCanvas').classList.add('ready');
      ['top-bar','game-container','test-version','about-section','footer'].forEach(id => {
        document.getElementById(id).style.display = 'flex';
      });
      document.body.querySelectorAll('link[rel="stylesheet"]').forEach(l => l.remove());
    });

    window.addEventListener('load', () => {
      window.cookieconsent.initialise({
        palette: { popup: { background: "#1b5e20" }, button: { background: "#00ff00" } },
        content: { message: "Este site usa cookies.", dismiss: "OK", link: "Saiba mais", href: "/politicas.html" }
      });

      const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
      if (!isMobile) {
        document.querySelectorAll('#left-ad ins, #right-ad ins').forEach(ad => {
          ad.style.width = '300px'; ad.style.height = '400px';
          (adsbygoogle = window.adsbygoogle || []).push({});
        });
      } else {
        document.querySelector('#top-ad ins').style = 'width:100%;max-width:400px;height:100px;background:#ccc;';
        (adsbygoogle = window.adsbygoogle || []).push({});
      }
    });

    // === MENU ===
    const menuToggle = document.getElementById('menu-toggle');
    const navMenu = document.getElementById('nav-menu');
    menuToggle?.addEventListener('click', () => navMenu.classList.toggle('open'));

    // === ÁUDIO SEGURO (MÚSICA NA 1ª JOGADA) ===
    let bgMusic = null;
    let audioUnlocked = false;

    function unlockAudio() {
      if (audioUnlocked) return;
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      if (AudioContext) new AudioContext().resume();
      audioUnlocked = true;
    }

    function playMusic() {
      if (bgMusic) return bgMusic.play().catch(() => {});
      bgMusic = new Audio('Musicgame.mp3');
      bgMusic.loop = true;
      bgMusic.volume = 0.5;
      bgMusic.play().catch(() => console.log("Música iniciada"));
    }

    // === JOGO ===
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const jumpSound = document.getElementById('jumpSound');
    const failSound = document.getElementById('failSound');
    const victorySound = document.getElementById('victorySound');

    const startBanner = document.getElementById('start-banner');
    const gameOverBanner = document.getElementById('game-over-banner');
    const victoryBanner = document.getElementById('victory-banner');
    const finalScore = document.getElementById('final-score');
    const victoryScore = document.getElementById('victory-score');
    const restartBtn = document.getElementById('restart-button');
    const playAgainBtn = document.getElementById('play-again-button');

    const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
    const BASE_W = 800, BASE_H = 400;
    let scaleX = 1, scaleY = 1, ALTURA_CHAO = isMobile ? 150 : 300;
    const ESPESSURA_CHAO = isMobile ? 20 : 50;
    const SAPO_H = 40, SAPO_OFF = 47;

    let sapo, obstaculos = [], poeira = [], tempo = 0, faseAtual = 0, pontuacao = 0;
    let gameStarted = false, animationId;

    const fases = ["primavera","verão","outono","inverno"];
    const cores = {
      primavera: {fundo:"#dcedc8", chao:"#81c784"},
      verão: {fundo:"#fff9c4", chao:"#fbc02d"},
      outono: {fundo:"#ffe0b2", chao:"#ff8f00"},
      inverno: {fundo:"#e0f7fa", chao:"#4dd0e1"}
    };

    function resize() {
      if (isMobile) {
        const w = Math.min(innerWidth - 20, 400);
        canvas.width = w; canvas.height = w/2;
        scaleX = w / BASE_W; scaleY = (w/2) / BASE_H;
        ALTURA_CHAO = canvas.height;
      } else {
        canvas.width = BASE_W; canvas.height = BASE_H;
        scaleX = scaleY = 1; ALTURA_CHAO = BASE_H;
      }
      if (sapo) sapo.y = ALTURA_CHAO - ESPESSURA_CHAO - SAPO_OFF * scaleY;
      positionBanners();
    }

    function positionBanners() {
      const rect = canvas.getBoundingClientRect();
      const container = document.getElementById('game-container').getBoundingClientRect();
      [startBanner, gameOverBanner, victoryBanner].forEach(b => {
        if (b.classList.contains('active')) {
          b.style.left = `${rect.left - container.left + rect.width/2}px`;
          b.style.top = `${rect.top - container.top + rect.height/2}px`;
          b.style.transform = 'translate(-50%, -50%)';
        }
      });
    }

    function handleJump() {
      if (!gameStarted || sapo.jumping) return;
      sapo.vy = -20 * scaleY; sapo.jumping = true;
      jumpSound.currentTime = 0; jumpSound.play();
      for (let i = 0; i < 10; i++) {
        poeira.push({
          x: sapo.x + 15*scaleX + Math.random()*10*scaleX,
          y: sapo.y + 30*scaleY,
          raio: (3+Math.random()*5)*scaleX,
          alpha: 0.7,
          vy: (-1-Math.random()*2)*scaleY,
          vx: (Math.random()*2-1)*scaleX
        });
      }
    }

    // === INICIAR NA 1ª JOGADA COM MÚSICA ===
    function startGame(e) {
      e.preventDefault();
      if (gameStarted || !startBanner.classList.contains('active')) return;
      startBanner.classList.remove('active');
      unlockAudio();
      playMusic(); // MÚSICA TOCA AQUI NA 1ª VEZ!
      iniciarJogo();
    }

    function resetGame() {
      cancelAnimationFrame(animationId);
      sapo = { x: BASE_W*0.2*scaleX, y: ALTURA_CHAO - ESPESSURA_CHAO - SAPO_OFF*scaleY, width:40*scaleX, height:SAPO_H*scaleY, vy:0, jumping:false };
      obstaculos = []; poeira = []; tempo = 0; faseAtual = 0; pontuacao = 0;
      gameStarted = false;
      [gameOverBanner, victoryBanner].forEach(b => b.classList.remove('active'));
      startBanner.classList.add('active');

      if (bgMusic) { bgMusic.pause(); bgMusic.currentTime = 0; }

      document.removeEventListener('keydown', handleKeyJump);
      canvas.removeEventListener('touchstart', handleJump);
      startBanner.addEventListener('click', startGame);
      startBanner.addEventListener('touchstart', startGame);
      document.addEventListener('keydown', startGame);

      if (audioUnlocked && bgMusic) setTimeout(() => bgMusic.play(), 100);

      resize();
    }

    function drawSapo() {
      ctx.save(); ctx.scale(scaleX, scaleY);
      const {x, y, jumping} = sapo;
      ctx.fillStyle = 'green';
      ctx.beginPath(); ctx.ellipse(x/scaleX+25, y/scaleY+18, 22, 15, 0, 0, Math.PI*2); ctx.fill();
      const angle = jumping ? Math.PI/2 : Math.PI/4;
      ctx.strokeStyle = 'green'; ctx.lineWidth = 3/scaleX;
      ctx.beginPath();
      ctx.moveTo(x/scaleX+18, y/scaleY+20); ctx.lineTo(x/scaleX+5, y/scaleY+20); ctx.lineTo(x/scaleX+5-Math.cos(angle)*18, y/scaleY+20+Math.sin(angle)*18);
      ctx.moveTo(x/scaleX+32, y/scaleY+20); ctx.lineTo(x/scaleX+45, y/scaleY+20); ctx.lineTo(x/scaleX+45+Math.cos(angle)*18, y/scaleY+20+Math.sin(angle)*18);
      ctx.stroke();
      ctx.fillStyle = 'yellow';
      ctx.beginPath(); ctx.arc(x/scaleX+15, y/scaleY+8, 6, 0, Math.PI*2); ctx.arc(x/scaleX+35, y/scaleY+8, 6, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = 'black';
      ctx.beginPath(); ctx.arc(x/scaleX+15, y/scaleY+8, 2, 0, Math.PI*2); ctx.arc(x/scaleX+35, y/scaleY+8, 2, 0, Math.PI*2); ctx.fill();
      ctx.restore();
    }

    function iniciarJogo() {
      gameStarted = true;
      document.addEventListener('keydown', e => (e.code === 'Space' || e.code === 'ArrowUp') && handleJump());
      canvas.addEventListener('touchstart', e => { e.preventDefault(); handleJump(); });
      animationId = requestAnimationFrame(gameLoop);
    }

    function gameLoop() {
      if (!gameStarted) return;
      const fase = fases[faseAtual % 4];
      canvas.style.background = cores[fase].fundo;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = cores[fase].chao;
      ctx.fillRect(0, ALTURA_CHAO - ESPESSURA_CHAO, canvas.width, ESPESSURA_CHAO);

      sapo.vy += 1.5 * scaleY; sapo.y += sapo.vy;
      if (sapo.y > ALTURA_CHAO - ESPESSURA_CHAO - SAPO_OFF*scaleY) {
        sapo.y = ALTURA_CHAO - ESPESSURA_CHAO - SAPO_OFF*scaleY;
        sapo.vy = 0; sapo.jumping = false;
      }
      drawSapo();

      // Poeira
      ctx.save(); ctx.scale(scaleX, scaleY);
      poeira = poeira.filter(p => {
        ctx.fillStyle = `rgba(143,188,143,${p.alpha})`;
        ctx.beginPath(); ctx.arc(p.x/scaleX, p.y/scaleY, p.raio/scaleX, 0, Math.PI*2); ctx.fill();
        p.x += p.vx; p.y += p.vy; p.raio -= 0.1*scaleX; p.alpha -= 0.02; p.vy *= 0.98;
        return p.raio > 0.2*scaleX && p.alpha > 0.05;
      });
      ctx.restore();

      // Obstáculos
      if (tempo % 120 === 0 && tempo >= 120) {
        const cor = ['#d32f2f','#fbc02d','#7b1fa2','#00796b'][Math.floor(Math.random()*4)];
        obstaculos.push({ x: BASE_W*scaleX, y: ALTURA_CHAO - ESPESSURA_CHAO - 30*scaleY, width:30*scaleX, height:30*scaleY, color: cor });
      }
      obstaculos.forEach(o => { o.x -= 5*scaleX; ctx.fillStyle = o.color; ctx.fillRect(o.x, o.y, o.width, o.height); });
      obstaculos = obstaculos.filter(o => o.x + o.width > 0);

      tempo++; pontuacao++;
      if (tempo % 1500 === 0) { faseAtual++; }

      ctx.fillStyle = '#000'; ctx.font = isMobile ? 'bold 16px Arial' : 'bold 18px Arial';
      ctx.fillText(`Score: ${pontuacao}`, 10, isMobile ? 20 : 25);

      // Colisão
      for (const o of obstaculos) {
        if (sapo.x < o.x + o.width && sapo.x + sapo.width > o.x &&
            sapo.y + 7*scaleY < o.y + o.height && sapo.y + SAPO_H*scaleY > o.y) {
          gameStarted = false; cancelAnimationFrame(animationId);
          failSound.play(); bgMusic?.pause();
          finalScore.textContent = pontuacao; gameOverBanner.classList.add('active'); positionBanners();
          return;
        }
      }

      if (pontuacao >= 5000) {
        gameStarted = false; cancelAnimationFrame(animationId);
        victorySound.play(); bgMusic?.pause();
        victoryScore.textContent = pontuacao; victoryBanner.classList.add('active'); positionBanners();
        return;
      }

      animationId = requestAnimationFrame(gameLoop);
    }

    // === CLIMA E HORA ===
    async function fetchWeather() {
      try {
        const res = await fetch('https://api.openweathermap.org/data/2.5/weather?q=S%C3%A3o%20Paulo&appid=b8a0cd03c689322da2746720be31d534&units=metric&lang=pt_br');
        const d = await res.json();
        document.getElementById('weather').textContent = `${Math.round(d.main.temp)}°C, ${d.weather[0].description}`;
      } catch { document.getElementById('weather').textContent = "Clima indisponível"; }
    }
    async function updateClock() {
      try {
        const res = await fetch('https://worldtimeapi.org/api/timezone/America/Sao_Paulo');
        const d = await res.json();
        const date = new Date(d.datetime);
        document.getElementById('clock').textContent = date.toLocaleString('pt-BR');
      } catch {
        document.getElementById('clock').textContent = new Date().toLocaleString('pt-BR');
      }
    }

    // === INICIAR ===
    window.addEventListener('load', () => {
      resize();
      window.addEventListener('resize', () => setTimeout(resize, 100));
      resetGame();
      fetchWeather(); updateClock();
      setInterval(fetchWeather, 600000); setInterval(updateClock, 60000);
    });

    restartBtn.addEventListener('click', resetGame);
    playAgainBtn.addEventListener('click', resetGame);
  </script>
</body>
</html>
